<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <link rel="stylesheet" href="style.css">
</head>
<body onload="showFoodList()">
    <div class="kentrarisma">
        <button type="button" onclick="showFoodList();">Εμφάνισε τη λίστα</button>
        <div class="buttons" style="display: none;"> 
            <button type="button" onclick="sortFoodTable(1)">Ταξινόμηση ανά Δημιουργός</button>
            <button type="button" onclick="sortByPrice(2)">Ταξινόμηση ανά Τιμή</button>
            <button type="button" onclick="sortByYear(3)">Ταξινόμηση ανά Έτος Δημιουργίας</button>
        </div>
        <br><br>
        <table id="foodTable" style="display: none;"></table>
        <h3 id="foodHeader" style="display: none;">ΠΑΡΑΔΟΣΙΑΚΑ ΦΑΓΗΤΑ</h3>
        <p id="sorted_food_list"></p>
    </div>

    <script>
        function showFoodList() {
            var buttonDiv = document.querySelector('.buttons');
            var table = document.getElementById('foodTable');
            var header = document.getElementById('foodHeader');

            buttonDiv.style.display = 'block';
            table.style.display = 'block';
            header.style.display = 'block';
            loadXMLDoc();
        }

        function loadXMLDoc() {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    myFunction(this);
                }
            };
            xmlhttp.open("GET", "https://raw.githubusercontent.com/ct20033/ct20033.github.io/main/data.xml", true);
            xmlhttp.send();
        }

        function myFunction(xml) {
            var arr = [];
            var i;
            var xmlDoc = xml.responseXML;
            var tableContent = "<tr><th>name</th><th>creator</th><th>year</th><th>price €</th></tr>";
            var x = xmlDoc.getElementsByTagName("food");

            for (i = 0; i < x.length; i++) {
                tableContent += "<tr><td>" +
                    x[i].getElementsByTagName("creator")[0].childNodes[0].nodeValue +
                    "</td><td>" +
                    x[i].getElementsByTagName("name")[0].childNodes[0].nodeValue +
                    "</td><td>" +
                    x[i].getElementsByTagName("year")[0].childNodes[0].nodeValue +
                    "</td><td>" +
                    x[i].getElementsByTagName("price")[0].childNodes[0].nodeValue +
                    "</td></tr>";
                arr[i] = x[i].getElementsByTagName("creator")[0].childNodes[0].nodeValue + ":" + x[i].getElementsByTagName("id")[0].childNodes[0].nodeValue;
            }
            document.getElementById("foodTable").innerHTML = tableContent;
            arr.sort();
            document.getElementById("sorted_food_list").innerHTML = arr;
        }

        function sortFoodTable(n) {
            var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
            table = document.getElementById("foodTable");
            switching = true;
            dir = "asc";

            while (switching) {
                switching = false;
                rows = table.rows;
                shouldSwitch = false;

                for (i = 1; i < (rows.length - 1); i++) {
                    x = rows[i].getElementsByTagName("td")[n];
                    y = rows[i + 1].getElementsByTagName("td")[n];

                    if (dir == "asc") {
                        if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                            shouldSwitch = true;
                            break;
                        }
                    } else if (dir == "desc") {
                        if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                            shouldSwitch = true;
                            break;
                        }
                    }
                }

                if (shouldSwitch) {
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                    switchcount++;
                } else {
                    if (switchcount == 0 && dir == "asc") {
                        dir = "desc";
                        switching = true;
                    }
                }
            }
        }

        function sortByPrice() {
            var table, rows, switching, i, x, y, shouldSwitch;
            table = document.getElementById("foodTable");
            switching = true;

            while (switching) {
                switching = false;
                rows = table.rows;

                for (i = 1; i < (rows.length - 1); i++) {
                    shouldSwitch = false;
                    x = parseFloat(rows[i].getElementsByTagName("td")[3].innerHTML);
                    y = parseFloat(rows[i + 1].getElementsByTagName("td")[3].innerHTML);

                    if (x > y) {
                        shouldSwitch = true;
                        break;
                    }
                }

                if (shouldSwitch) {
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                }
            }
        }

        function sortByYear() {
            var table, rows, switching, i, x, y, shouldSwitch;
            table = document.getElementById("foodTable");
            switching = true;

            while (switching) {
                switching = false;
                rows = table.rows;

                for (i = 1; i < (rows.length - 1); i++) {
                    shouldSwitch = false;
                    x = parseInt(rows[i].getElementsByTagName("td")[2].innerHTML);
                    y = parseInt(rows[i + 1].getElementsByTagName("td")[2].innerHTML);

                    if (x < y) {
                        shouldSwitch = true;
                        break;
                    }
                }

                if (shouldSwitch) {
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                }
            }
        }
    </script>
</body>
</html>
